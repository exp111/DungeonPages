<!DOCTYPE html>
<html>

<head>
    <title>Grid Test</title>
    <style>
        :root {
            --tile-size: 50px;
            --gap-size: 10px;
        }

        .grid {
            --row-count: 6;
            --column-count: 6;
            background-color: #e6e5e5;
            display: grid;
            grid-template-columns: repeat(var(--row-count), 1fr);
            grid-template-rows: repeat(var(--column-count), 1fr);
            gap: var(--gap-size);
            padding: var(--gap-size);
            width: calc(var(--column-count) * var(--tile-size) + (var(--column-count) + 1) * var(--gap-size));
            height: calc(var(--column-count) * var(--tile-size) + (var(--column-count) + 1) * var(--gap-size));
        }

        .tile {
            border-radius: 3px;
        }

        .tile-space {
            background-color: white;
        }

        .tile-wall {
            background-color: #b9b5b3;
        }

        .tile-monster, .tile-item, .tile-entry, .tile-exit, .tile-trap {
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center center;
        }

        .tile-entry {
            background-image: url("assets/img/door.svg");
        }
        .tile-exit {
            background-image: url("assets/img/chest.svg");
        }

        .tile-coin {
            background-image: url("assets/img/coin.svg");
        }

        .tile-potion {
            background-image: url("assets/img/potion.svg");
        }

        .tile-guardian {
            background-image: url("assets/img/guardian.svg");
        }
    </style>
</head>

<body>
    <div id="map">

    </div>
    <script>
        class Map {
            Dungeons = [];
            Monsters = [];
            Traps = [];
        }

        class Dungeon {
            Name = "";
            isBoss = false;
            Rows = 6;
            Columns = 6;
            Dice = 1;
            Tiles = [];
            DOMObject = null;

            CreateDOM() {
                // Create the grid
                let ret = document.createElement("div");
                ret.classList.add("grid");
                ret.style.setProperty("--row-count", this.Rows);
                ret.style.setProperty("--columns-count", this.Columns);
                // then add the tiles
                for (let i in this.Tiles)
                {
                    let t = this.Tiles[i];
                    ret.appendChild(t.DOMObject);
                }
                // then return
                this.DOMObject = ret;
                return ret;
            }
            static FromJson(json) {
                let dungeon = new Dungeon();

                dungeon.Name = json.name;
                dungeon.Rows = json.rows,
                dungeon.Columns = json.columns;
                if (json.boss != null)
                    dungeon.isBoss = json.boss;
                dungeon.Dice = json.dice;
                for (let i in json.tiles) {
                    let t = json.tiles[i];
                    dungeon.Tiles.push(Tile.FromJson(t));
                }
                dungeon.CreateDOM();
                return dungeon;
            }
        }

        class Tile {
            Type = "space"; // space, wall, monster, trap, entry, exit, item //TODO: enum
            Subtype = "";
            Width = 1;
            Height = 1;
            DOMObject = null;

            CreateDOM() {
                // Create tile
                let ret = document.createElement("div");
                ret.classList.add("tile");
                ret.classList.add(`tile-${this.Type}`);
                if (this.Subtype)
                    ret.classList.add(`tile-${this.Subtype}`);
                ret.style.setProperty("grid-column-end", `span ${this.Width}`);
                ret.style.setProperty("grid-row-end", `span ${this.Height}`);
                // return it
                this.DOMObject = ret;
                return ret;
            }

            static FromJson(json) {
                let tile = new Tile();
                tile.Type = json.type;
                if (json.subtype != null)
                    tile.Subtype = json.subtype;
                if (json.w != null)
                    tile.Width = json.w;
                if (json.h != null)
                    tile.Height = json.h;
                tile.CreateDOM(tile);
                return tile;
            }
        }
        var dungeonJson = {
            "name": "The Cave",
            "rows": 6,
            "columns": 6,
            "dice": 1,
            //TODO: add special abilities?
            "tiles": [
                // 1
                {
                    "type": "wall"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "entry"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                // 2
                {
                    "type": "space"
                },
                {
                    "type": "monster",
                    "subtype": "guardian"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                // 3
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "space"
                },
                {
                    "type": "item",
                    "subtype": "coin"
                },
                {
                    "type": "space"
                },
                // 4
                {
                    "type": "item",
                    "subtype": "potion"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                // 5
                {
                    "type": "item",
                    "subtype": "coin"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                // 6
                {
                    "type": "space"
                },
                {
                    "type": "space"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "exit"
                },
                {
                    "type": "wall"
                },
                {
                    "type": "wall"
                },
            ]
        };
        var dungeon = Dungeon.FromJson(dungeonJson);
        var map = document.getElementById("map");
        map.appendChild(dungeon.DOMObject);
    </script>
</body>

</html>